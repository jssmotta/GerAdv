// 100% auto-generated by Source Genesys WebApi Front & Back Creator
// copyright © 2000-2025 Menphis - Sistemas Inteligentes
// This file is part of the Source Genesys project                     
#pragma warning disable IDE0130 // Namespace does not match folder structure

namespace MenphisSI.GerAdv.WarmUp;
#pragma warning restore IDE0130 // Namespace does not match folder structure

public partial class CidadeWarmUp
{
    public async Task WarmReadStringAuditor(string uri, MsiSqlConnection? oCnn) => await CreateIdx(uri, oCnn);
    private async Task CreateIdx(string uri, MsiSqlConnection oCnn)
    {
        Console.WriteLine($"WarmUp Cidade: {uri}");
        var testSql = $"SELECT TOP (1) '1' FROM sys.indexes WHERE name = 'idx_Cidade_AuditorDtAtu' AND object_id = OBJECT_ID('[{oCnn.UseDbo}].[Cidade]')";
        using var cmd = new SqlCommand(testSql, oCnn.InnerConnection);
        var result = $"{await cmd.ExecuteScalarAsync()}";
        if (result == "1")
        {
            return;
        }

        using var oCnnRw = Configuracoes.GetConnectionByUriRw(uri);
        if (oCnnRw is null)
            return;
        ConfiguracoesDBT.ExecuteSqlCreate($@"IF NOT EXISTS (SELECT * FROM sys.indexes WHERE name = 'idx_Cidade_AuditorDtAtu' AND object_id = OBJECT_ID('[{oCnnRw.UseDbo}].[Cidade]'))
                BEGIN
                    DROP INDEX [{oCnnRw.UseDbo}].idx_Cidade_AuditorDtAtu;
                END
                ", oCnnRw);
        ConfiguracoesDBT.ExecuteSqlCreate($@"IF NOT EXISTS (SELECT * FROM sys.indexes WHERE name = 'idx_Cidade_AuditorDtAtu' AND object_id = OBJECT_ID('[{oCnnRw.UseDbo}].[Cidade]'))
                BEGIN                    
                    CREATE INDEX idx_Cidade_AuditorDtAtu ON [{oCnnRw.UseDbo}].[Cidade](cidCodigo, cidDtAtu);
                END
                ", oCnnRw);
    }
}